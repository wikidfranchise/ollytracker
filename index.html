<!DOCTYPE html>
<!-- Preview deploy test -->
<!-- retrigger deploy -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The OllyStream‚Ñ¢ - Live SEC Filings with OTCV</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root { 
            --h1-size: 2.5rem; 
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ============================================
           HEADER SECTION - Compact Layout with Dark Theme
           ============================================ */
        
        .header-wrapper {
            text-align: center;
            padding: 10px 20px 5px 20px;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            padding: 0;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Logo Styling - Gold filter for dark background */
        .brand-logo {
            height: 180px;
            width: auto;
            filter: brightness(0) saturate(100%) invert(68%) sepia(89%) saturate(485%) hue-rotate(5deg) brightness(103%) contrast(106%);
            -webkit-filter: brightness(0) saturate(100%) invert(68%) sepia(89%) saturate(485%) hue-rotate(5deg) brightness(103%) contrast(106%);
        }

        /* Title and Tagline Container */
        .title-section {
            text-align: left;
        }

        .page-title {
            color: #ffd700;
            margin: 0;
            font-size: 2.2em;
            font-weight: bold;
            line-height: 1;
            background: linear-gradient(45deg, #ffd700, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            color: white;
            font-size: 1.1em;
            opacity: 0.9;
            margin-top: 5px;
            line-height: 1.2;
        }

        .page-tagline {
            color: #ffd700;
            font-size: 0.85em;
            opacity: 0.95;
            margin-top: 3px;
        }

        .tm {
            font-size: 0.65em;
            vertical-align: super;
            margin-left: 1px;
        }

        /* ============================================
           NAVIGATION BAR - Compact Style with Dark Theme
           ============================================ */
        
        .main-nav {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(0,0,0,0.25);
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .nav-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 14px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 600;
            font-size: 13px;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: rgba(255,215,0,0.3);
            border-color: #ffd700;
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(255,215,0,0.2);
        }

        .nav-btn.active {
            background: #ffd700;
            color: #333;
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255,215,0,0.5);
        }

        /* Connection Info - Original dark theme */
        .connection-info {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px;
            z-index: 1000;
            font-size: 0.8rem;
            max-width: 300px;
        }

        .trending-ticker {
            cursor: pointer;
        }

        .trending-ticker:hover {
            text-decoration: underline; 
        }

        .connection-info h4 {
            color: #ffd700;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .connection-detail {
            margin: 4px 0;
            display: flex;
            justify-content: space-between;
        }

        .connection-detail strong {
            color: #ffd700;
        }

        /* Rest of original dark theme styles continue... */
        .controls {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc3545;
            animation: pulse 2s infinite;
        }

        .status-indicator.connecting {
            background: #ffc107;
        }

        .status-indicator.connected {
            background: #28a745;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd700;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .controls-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .toggle-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .toggle-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .toggle-btn.active {
            background: #ffd700;
            color: #333;
        }

        .ticker-window {
            background: rgba(0,0,0,0.8);
            margin: 15px 20px;
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            overflow: hidden;
            height: 120px;
            position: relative;
        }

        .ticker-window h3 {
            color: #ffd700;
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.1rem;
        }

        .ticker-content {
            display: flex;
            animation: scroll-ticker 30s linear infinite;
            white-space: nowrap;
        }

        @keyframes scroll-ticker {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .ticker-item {
            margin-right: 40px;
            padding: 8px 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 0.9rem;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ticker-item:hover {
            background: rgba(255,255,255,0.2);
            border-color: #ffd700;
            transform: scale(1.05);
        }

        .ticker-ticker {
            color: #ffd700;
            font-weight: bold;
            font-family: monospace;
        }

        .ticker-form {
            color: #00ff88;
            margin-left: 10px;
        }

        .filter-section {
            background: rgba(0,0,0,0.2);
            padding: 12px 20px;
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-select {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        }

        .filter-select option {
            background: #333;
            color: white;
        }

        .filing-intelligence {
            background: rgba(0,0,0,0.3);
            margin: 15px 20px;
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .filing-intelligence h3 {
            color: #ffd700;
            margin-bottom: 6px;
            text-align: center;
            font-size: 1.6rem;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .filing-intelligence p {
            text-align: center;
            opacity: 0.8;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .intelligence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .intelligence-category {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .intelligence-category:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .intelligence-category::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .intelligence-category:hover::before {
            opacity: 1;
        }

        .intelligence-category[data-category="executive"]::before {
            background: linear-gradient(90deg, #ff6b6b, #ee5a24);
        }

        .intelligence-category[data-category="insider"]::before {
            background: linear-gradient(90deg, #ffd700, #ffed4e);
        }

        .intelligence-category[data-category="hostile"]::before {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }

        .intelligence-category[data-category="strategic"]::before {
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
        }

        .intelligence-category[data-category="institutional"]::before {
            background: linear-gradient(90deg, #74b9ff, #0984e3);
        }

        .intelligence-category[data-category="earnings"]::before {
            background: linear-gradient(90deg, #00b894, #00cec9);
        }

        .intelligence-category[data-category="offerings"]::before {
            background: linear-gradient(90deg, #a29bfe, #6c5ce7);
        }

        .intelligence-category[data-category="governance"]::before {
            background: linear-gradient(90deg, #fd79a8, #e84393);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .category-header h4 {
            color: white;
            font-size: 1rem;
            margin: 0;
        }

        .category-count {
            background: rgba(255,215,0,0.2);
            color: #ffd700;
            padding: 3px 10px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.8rem;
            border: 1px solid rgba(255,215,0,0.3);
        }

        .category-description {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-bottom: 12px;
            line-height: 1.2;
        }

        .category-companies {
            min-height: 50px;
        }

        .company-item {
            background: rgba(255,255,255,0.08);
            border-radius: 8px;
            padding: 8px 12px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .company-item:hover {
            background: rgba(255,255,255,0.12);
            transform: translateX(5px);
        }

        .company-item.hot {
            border-left-color: #ff6b6b;
            background: rgba(255,107,107,0.1);
        }

        .company-item.portfolio {
            border-left-color: #ffd700;
            background: rgba(255,215,0,0.1);
        }

        .company-ticker {
            font-weight: bold;
            color: #ffd700;
            font-family: monospace;
        }

        .company-form {
            font-size: 0.8rem;
            opacity: 0.8;
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .company-time {
            font-size: 0.75rem;
            opacity: 0.6;
        }

        .no-activity {
            text-align: center;
            padding: 20px;
            opacity: 0.5;
            font-style: italic;
        }

        .intelligence-alerts {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .intelligence-alerts h4 {
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        .alert-toggles {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .alert-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }

        .alert-toggle:hover {
            background: rgba(255,255,255,0.1);
            transform: scale(1.05);
        }

        .alert-toggle input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #ffd700;
        }

        .alert-toggle span {
            font-size: 0.9rem;
            color: white;
        }

        .intelligence-category.active {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255,215,0,0.3);
        }

        .intelligence-category.active .category-count {
            background: #ffd700;
            color: #333;
        }

        .trending {
            background: rgba(0,0,0,0.3);
            margin: 20px;
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .trending h3 {
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        .trending-companies {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .trending-item {
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .trending-ticker {
            font-weight: bold;
            color: #ffd700;
        }

        .trending-count {
            background: #ffd700;
            color: #333;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .filing-type-buttons {
            margin-top: 25px;
        }

        .form-type-grid {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 1200px;
            margin: 0 auto;
        }

        .form-type-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.7);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 11px;
            font-weight: bold;
            text-align: center;
            line-height: 1.1;
            min-width: 80px;
            position: relative;
            opacity: 0.6;
        }

        .form-type-btn span {
            display: none;
        }

        .form-type-btn:hover {
            transform: scale(1.05);
            opacity: 1;
            background: rgba(255,255,255,0.1);
        }

        .form-type-btn.active {
            border-color: #ffd700;
            background: rgba(255,215,0,0.2);
            color: #ffd700;
            opacity: 1;
            box-shadow: 0 0 15px rgba(255,215,0,0.3);
        }

        .form-type-btn.has-filings {
            opacity: 1;
            color: white;
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.4);
            box-shadow: 0 0 10px rgba(255,255,255,0.2);
            animation: filingsGlow 2s ease-in-out infinite alternate;
        }

        @keyframes filingsGlow {
            from {
                box-shadow: 0 0 5px rgba(255,255,255,0.2);
            }
            to {
                box-shadow: 0 0 15px rgba(255,255,255,0.4);
            }
        }

        .form-type-btn.has-filings.annual {
            border-color: rgba(0,123,255,0.6);
            background: rgba(0,123,255,0.15);
            color: #7cc7ff;
            box-shadow: 0 0 10px rgba(0,123,255,0.3);
        }

        .form-type-btn.has-filings.quarterly {
            border-color: rgba(40,167,69,0.6);
            background: rgba(40,167,69,0.15);
            color: #71dd8a;
            box-shadow: 0 0 10px rgba(40,167,69,0.3);
        }

        .form-type-btn.has-filings.current {
            border-color: rgba(220,53,69,0.6);
            background: rgba(220,53,69,0.15);
            color: #f1919c;
            box-shadow: 0 0 10px rgba(220,53,69,0.3);
        }

        .form-type-btn.has-filings.insider {
            border-color: rgba(255,193,7,0.6);
            background: rgba(255,193,7,0.15);
            color: #ffe066;
            box-shadow: 0 0 10px rgba(255,193,7,0.3);
        }

        .form-type-btn.has-filings.institutional {
            border-color: rgba(108,117,125,0.6);
            background: rgba(108,117,125,0.15);
            color: #bdc4ca;
            box-shadow: 0 0 10px rgba(108,117,125,0.3);
        }

        .form-type-btn.has-filings.proxy {
            border-color: rgba(111,66,193,0.6);
            background: rgba(111,66,193,0.15);
            color: #b794e6;
            box-shadow: 0 0 10px rgba(111,66,193,0.3);
        }

        .form-type-btn.has-filings.registration {
            border-color: rgba(255,105,180,0.6);
            background: rgba(255,105,180,0.15);
            color: #ff8ac4;
            box-shadow: 0 0 10px rgba(255,105,180,0.3);
        }

        .form-type-btn.has-filings.private {
            border-color: rgba(255,140,0,0.6);
            background: rgba(255,140,0,0.15);
            color: #ffb366;
            box-shadow: 0 0 10px rgba(255,140,0,0.3);
        }

        .form-type-btn.has-filings.beneficial {
            border-color: rgba(32,201,151,0.6);
            background: rgba(32,201,151,0.15);
            color: #66d9a8;
            box-shadow: 0 0 10px rgba(32,201,151,0.3);
        }

        .form-type-btn.has-filings.sales {
            border-color: rgba(13,202,240,0.6);
            background: rgba(13,202,240,0.15);
            color: #66d7f0;
            box-shadow: 0 0 10px rgba(13,202,240,0.3);
        }

        .form-type-btn.has-filings.initial {
            border-color: rgba(173,181,189,0.6);
            background: rgba(173,181,189,0.15);
            color: #c8ced5;
            box-shadow: 0 0 10px rgba(173,181,189,0.3);
        }

        .form-type-btn.has-filings.all {
            border-color: rgba(255,215,0,0.6);
            background: rgba(255,215,0,0.15);
            color: #ffed66;
            box-shadow: 0 0 10px rgba(255,215,0,0.3);
        }

        .form-type-btn.active.has-filings {
            border-color: #ffd700;
            background: rgba(255,215,0,0.25);
            color: #ffd700;
            box-shadow: 0 0 20px rgba(255,215,0,0.5);
        }

        .portfolio-toggle {
            position: fixed !important;
            right: 20px !important;
            top: 120px !important;
            transform: none !important;
            background: rgba(0,0,0,0.8);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 12px;
            border-radius: 8px 0 0 8px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            z-index: 10000 !important;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-weight: bold;
        }

        .portfolio-toggle:hover {
            background: rgba(255,215,0,0.2);
            border-color: #ffd700;
            color: #ffd700;
        }

        .portfolio-toggle.active {
            background: rgba(255,215,0,0.3);
            color: #ffd700;
            border-color: #ffd700;
        }

        .portfolio-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 380px;
            height: 100vh;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255,255,255,0.2);
            transition: right 0.3s ease;
            z-index: 999;
            overflow-y: auto;
            padding: 20px;
        }

        .portfolio-panel.open {
            right: 0;
        }

        .portfolio-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .portfolio-panel-title {
            color: #ffd700;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .portfolio-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        .portfolio-close:hover {
            color: #ffd700;
        }

        .portfolio-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .portfolio-stat {
            text-align: center;
        }

        .portfolio-stat-number {
            color: #ffd700;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .portfolio-stat-label {
            opacity: 0.8;
            font-size: 0.8rem;
        }

        .portfolio-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .portfolio-search {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            width: 200px;
        }

        .portfolio-search::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .portfolio-add-btn {
            background: rgba(40,167,69,0.2);
            border: 1px solid rgba(40,167,69,0.5);
            color: #28a745;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .portfolio-add-btn:hover {
            background: rgba(40,167,69,0.3);
            transform: scale(1.05);
        }

        .portfolio-filter-btn {
            background: rgba(255,215,0,0.2);
            border: 1px solid rgba(255,215,0,0.5);
            color: #ffd700;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .portfolio-filter-btn:hover, .portfolio-filter-btn.active {
            background: rgba(255,215,0,0.3);
            transform: scale(1.05);
        }

        .portfolio-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .portfolio-company {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .portfolio-company:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .portfolio-company.has-activity {
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255,215,0,0.3);
            animation: portfolioPulse 2s infinite;
        }

        @keyframes portfolioPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(255,215,0,0.3); }
            50% { box-shadow: 0 0 25px rgba(255,215,0,0.5); }
        }

        .portfolio-company-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .portfolio-ticker {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
            font-family: monospace;
        }

        .portfolio-remove {
            background: rgba(220,53,69,0.2);
            border: 1px solid rgba(220,53,69,0.5);
            color: #dc3545;
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.3s;
        }

        .portfolio-remove:hover {
            background: rgba(220,53,69,0.3);
            transform: scale(1.1);
        }

        .portfolio-company-name {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .portfolio-activity {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
        }

        .portfolio-activity-count {
            color: #ffd700;
            font-weight: bold;
        }

        .portfolio-last-filing {
            opacity: 0.7;
        }

        .portfolio-activity-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .portfolio-empty {
            text-align: center;
            padding: 40px;
            opacity: 0.7;
        }

        .portfolio-empty h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .portfolio-suggestions {
            margin-top: 20px;
            text-align: center;
        }

        .portfolio-suggestions h4 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .suggestion-chips {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .suggestion-chip {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
            position: relative;
        }

        .suggestion-chip:hover {
            background: rgba(255,215,0,0.2);
            border-color: #ffd700;
            color: #ffd700;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(255,215,0,0.3);
        }

        .suggestion-chip.active {
            background: rgba(255,215,0,0.3);
            border-color: #ffd700;
            color: #ffd700;
        }

        .suggestion-chip.active:after {
            content: '‚úî';
            position: absolute;
            top: -5px;
            right: -5px;
            background: #28a745;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .filings-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 15px;
        }

        .filing-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            animation: slideIn 0.5s ease-out;
            position: relative;
            overflow: hidden;
            max-width: 380px;
        }

        .filing-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            background: rgba(255,255,255,0.15);
        }

        .filing-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .filing-card:hover::before {
            left: 100%;
        }

        .filing-card.portfolio-company-filing {
            border-left: 3px solid #ffd700;
            background: rgba(255,215,0,0.1);
        }

        .filing-card.portfolio-company-filing .ticker {
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .filing-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .company-info {
            flex: 1;
        }

        .ticker {
            font-size: 1.1rem;
            font-weight: bold;
            color: #ffd700;
            font-family: monospace;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .ticker:hover {
            text-shadow: 0 0 10px rgba(255,215,0,0.8);
        }

        .company-name {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 3px;
            line-height: 1.2;
        }

        .form-type {
            background: rgba(255,215,0,0.2);
            color: #ffd700;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            border: 1px solid rgba(255,215,0,0.3);
        }

        .filing-details {
            margin: 12px 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin: 6px 0;
            font-size: 0.8rem;
        }

        .detail-label {
            opacity: 0.8;
        }

        .detail-value {
            font-weight: 500;
        }

        .filed-time {
            color: #ffd700;
        }

        .filing-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            min-width: 100px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
            text-align: center;
        }

        .action-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .action-btn.primary {
            background: #ffd700;
            color: #333;
            font-weight: bold;
        }

        .action-btn.primary:hover {
            background: #ffed4e;
        }

        /* OTCV Button Style */
        .action-btn.otcv {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid #ffd700;
            color: #ffd700;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        .action-btn.otcv:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: scale(1.08);
            box-shadow: 0 0 20px rgba(255,215,0,0.4);
        }

        .action-btn.otcv::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,215,0,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .action-btn.otcv:hover::before {
            width: 300px;
            height: 300px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .company-badges {
            margin-top: 4px;
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
        }

        .index-badge {
            background: rgba(255,215,0,0.2);
            color: #ffd700;
            padding: 1px 5px;
            border-radius: 6px;
            font-size: 0.65rem;
            margin-right: 3px;
            display: inline-block;
        }

        .exchange-badge {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 1px 5px;
            border-radius: 6px;
            font-size: 0.65rem;
            margin-right: 3px;
            display: inline-block;
        }

        .no-filings {
            text-align: center;
            padding: 30px;
            opacity: 0.7;
            font-size: 1rem;
            grid-column: 1 / -1;
        }

        .notification {
            position: fixed !important;
            right: -500px !important;
            top: 80px !important;
            z-index: 99999 !important;
            max-width: 400px !important;
            transition: right 0.5s ease !important;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            border-left: 4px solid #ffd700;
            backdrop-filter: blur(10px);
        }

        #notification.show {
            right: 20px !important;
        }

        .hot-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background: #dc3545;
            color: white;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: bold;
            animation: bounce 1s infinite;
        }

        /* Filing type color badges (vibrant, dark text, two-color) */
        .form-badge {
            position: absolute; 
            top: 10px; 
            right: 10px;
            padding: 6px 10px; 
            border-radius: 10px;
            font-size: 12px; 
            font-weight: 800; 
            letter-spacing: 0.3px;
            color: #0b1b3b; 
            border: 2px solid #0b1b3b;
            cursor: pointer; 
            user-select: none;
            box-shadow: 0 2px 0 rgba(0,0,0,0.35);
        }

        .form-badge:focus { 
            outline: 2px solid #ffd60a; 
            outline-offset: 2px; 
        }

        .form-badge:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 3px 0 rgba(0,0,0,0.35); 
        }

        /* School colors by form family */
        .badge-insider { background: linear-gradient(135deg, #FFD700, #FF9F0A); }
        .badge-144     { background: linear-gradient(135deg, #FF2D55, #FF375F); }
        .badge-8k      { background: linear-gradient(135deg, #FF3B30, #FF453A); }
        .badge-10k     { background: linear-gradient(135deg, #34C759, #30DB5B); }
        .badge-10q     { background: linear-gradient(135deg, #0A84FF, #64D2FF); }
        .badge-def14a  { background: linear-gradient(135deg, #AF52DE, #BF5AF2); }
        .badge-13d     { background: linear-gradient(135deg, #FF9F0A, #FFD60A); }
        .badge-13g     { background: linear-gradient(135deg, #64D2FF, #32ADE6); }
        .badge-13f     { background: linear-gradient(135deg, #A1A1A6, #C7C7CC); }
        .badge-offering{ background: linear-gradient(135deg, #5856D6, #5E5CE6); }
        .badge-default { background: linear-gradient(135deg, #E5E7EB, #D1D5DB); }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .brand-logo {
                height: 150px;
            }
            
            .title-section {
                text-align: center;
            }
            
            .page-title {
                font-size: 1.8em;
            }
            
            .page-subtitle {
                font-size: 1em;
            }
            
            .nav-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .brand-logo {
                height: 120px;
            }
            
            .page-title {
                font-size: 1.3em;
            }
            
            .page-subtitle {
                font-size: 0.9em;
            }
            
            .main-nav {
                gap: 5px;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="connection-info" id="connectionInfo">
        <h4>üìå OllyTracker<sup class="tm">‚Ñ¢</sup> Connection</h4>
        <div class="connection-detail">
            <span><strong>Status:</strong></span>
            <span id="apiStatus">Connecting...</span>
        </div>
        <div class="connection-detail">
            <span><strong>Uptime:</strong></span>
            <span id="uptime">00:00:00</span>
        </div>
    </div>

    <div class="header-wrapper">
        <div class="header-content">
            <img src="OllyTracker Yacht Logo.png" alt="OllyTracker" class="brand-logo">
            
            <div class="title-section">
                <h1 class="page-title">The OllyStream<sup class="tm">‚Ñ¢</sup></h1>
                <p class="page-subtitle">Live SEC Filings Stream - Real-Time EDGAR Data</p>
                <p class="page-tagline">Powered by OllyTracker‚Ñ¢ with OTCV Intelligence</p>
            </div>
        </div>
    </div>

    <nav class="main-nav">
        <a href="OllyStream.html" class="nav-btn active">‚ö° OllyStream</a>
        <a href="OllyTracker.html" class="nav-btn" target="_blank">üìà OllyTracker</a>
        <a href="OllyCortex.html" class="nav-btn" target="_blank">üß† OllyCortex</a>
        <a href="OllyInsider.html" class="nav-btn" target="_blank">üïµÔ∏è OllyInsider</a>
        <a href="OllyComp.html" class="nav-btn" target="_blank">üíµ OllyComp</a>
        <a href="OllyEnforcer.html" class="nav-btn" target="_blank">‚öñÔ∏è OllyEnforcer</a>
        <a href="OllyLookup.html" class="nav-btn" target="_blank">üîç OllyLookup</a>
        <a href="OllyAuditor.html" class="nav-btn" target="_blank">üìä OllyAuditor</a>
    </nav>

    <div class="controls">
        <div class="status">
            <div class="status-indicator" id="statusIndicator"></div>
            <span id="statusText">Connecting to secapi.io...</span>
        </div>

        <div class="stats">
            <div class="stat">
                <div class="stat-number" id="totalFilings">0</div>
                <div class="stat-label">Today's Filings</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="filingRate">0</div>
                <div class="stat-label">Per Minute</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="uniqueCompanies">0</div>
                <div class="stat-label">Companies</div>
            </div>
        </div>

        <div class="controls-right">
            <button class="toggle-btn active" id="soundToggle">üîä Sound On</button>
            <button class="toggle-btn" id="pauseToggle">‚è∏Ô∏è Pause</button>
            <button class="toggle-btn" id="clearToggle">üóëÔ∏è Clear</button>
        </div>
    </div>

    <div class="ticker-window">
        <h3>üìà Live Filing Ticker</h3>
        <div class="ticker-content" id="tickerContent">
            <div class="ticker-item">Connecting to live stream...</div>
        </div>
    </div>

    <div class="filter-section">
        <div class="filter-group">
            <label>üìä Exchange:</label>
            <select class="filter-select" id="exchangeFilter">
                <option value="">All Exchanges</option>
                <option value="NASDAQ">NASDAQ</option>
                <option value="NYSE">NYSE</option>
                <option value="AMEX">NYSE American</option>
                <option value="OTC">OTC Markets</option>
            </select>
        </div>
        <div class="filter-group">
            <label>üèÜ Index:</label>
            <select class="filter-select" id="indexFilter">
                <option value="">All Indices</option>
                <option value="SP500">S&P 500</option>
                <option value="SP100">S&P 100</option>
                <option value="DOW30">Dow Jones 30</option>
                <option value="NASDAQ100">NASDAQ 100</option>
                <option value="RUSSELL2000">Russell 2000</option>
                <option value="RUSSELL1000">Russell 1000</option>
            </select>
        </div>
        <div class="filter-group">
            <label>üìã Form Type:</label>
            <select class="filter-select" id="formFilter">
                <option value="">All Forms</option>
                <option value="10-K">10-K (Annual Reports)</option>
                <option value="10-Q">10-Q (Quarterly Reports)</option>
                <option value="8-K">8-K (Current Reports)</option>
                <option value="DEF 14A">DEF 14A (Proxy Statements)</option>
                <option value="4">Form 4 (Insider Trading)</option>
                <option value="13F">13F (Institutional Holdings)</option>
                <option value="144">Form 144 (Insider Sales)</option>
                <option value="3">Form 3 (Initial Ownership)</option>
            </select>
        </div>
    </div>

    <div class="trending" id="trending">
        <h3>üî• Filing Diligence Dashboard</h3>
        <div class="trending-companies" id="trendingCompanies">
            <div class="no-filings">No activity yet...</div>
        </div>
        
        <div class="filing-type-buttons">
    <h4 style="color: #ffd700; margin: 20px 0 15px 0; text-align: center;">üìã Filter by Filing Type</h4>
    
    <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; padding: 10px;">
        <button class="form-type-btn annual active" onclick="secStream.filterByFormType('10-K')" title="10-K Annual Reports">
            üìä 10-K
        </button>
        <button class="form-type-btn quarterly has-filings" onclick="secStream.filterByFormType('10-Q')" title="10-Q Quarterly Reports">
            üìà 10-Q
        </button>
        <button class="form-type-btn current has-filings" onclick="secStream.filterByFormType('8-K')" title="8-K Current Reports">
            üö® 8-K
        </button>
        <button class="form-type-btn initial" onclick="secStream.filterByFormType('3')" title="Form 3 - Initial Statement of Ownership">
            üìù Form 3
        </button>
        <button class="form-type-btn insider has-filings" onclick="secStream.filterByFormType('4')" title="Form 4 - Statement of Changes in Ownership">
            üí° Form 4
        </button>
        <button class="form-type-btn insider-annual" onclick="secStream.filterByFormType('5')" title="Form 5 - Annual Statement of Ownership">
            üìÖ Form 5
        </button>
        <button class="form-type-btn sales has-filings" onclick="secStream.filterByFormType('144')" title="Form 144 - Notice of Proposed Sale">
            üí∞ Form 144
        </button>
        <button class="form-type-btn proxy" onclick="secStream.filterByFormType('DEF 14A')" title="DEF 14A - Proxy Statement (Board Elections)">
            üó≥Ô∏è DEF 14A
        </button>
        <button class="form-type-btn exec-change" onclick="secStream.filterByFormType('8-K-5.02')" title="8-K Item 5.02 - Executive/Director Changes">
            üë• Exec Changes
        </button>
        <button class="form-type-btn beneficial" onclick="secStream.filterByFormType('13D')" title="Schedule 13D - Active Investor 5%+ Ownership">
            ‚öîÔ∏è SC 13D
        </button>
        <button class="form-type-btn beneficial-passive" onclick="secStream.filterByFormType('13G')" title="Schedule 13G - Passive Investor 5%+ Ownership">
            üìä SC 13G
        </button>
        <button class="form-type-btn institutional has-filings" onclick="secStream.filterByFormType('13F')" title="13F - Institutional Holdings Report">
            üè¶ 13F
        </button>
        <button class="form-type-btn tender" onclick="secStream.filterByFormType('SC TO')" title="Schedule TO - Tender Offer">
            üéØ SC TO
        </button>
        <button class="form-type-btn control-change" onclick="secStream.filterByFormType('8-K-5.01')" title="8-K Item 5.01 - Change in Control">
            üîÑ Control Change
        </button>
        <button class="form-type-btn registration" onclick="secStream.filterByFormType('S-1')" title="S-1 - IPO Registration">
            üöÄ S-1
        </button>
        <button class="form-type-btn employee-plan" onclick="secStream.filterByFormType('S-8')" title="S-8 - Employee Stock Plan Registration">
            üë• S-8
        </button>
        <button class="form-type-btn private has-filings" onclick="secStream.filterByFormType('D')" title="Form D - Private Placement">
            üíº Form D
        </button>
        <button class="form-type-btn benefit-plan" onclick="secStream.filterByFormType('11-K')" title="11-K - Employee Benefit Plan Annual Report">
            üìä 11-K
        </button>
        <button class="form-type-btn all has-filings" onclick="secStream.clearFormTypeFilter()" title="Show All Filing Types">
            üìÑ All Forms
        </button>
    </div>
</div>
    <div style="background: rgba(0,0,0,0.2); padding: 12px 20px; text-align: center; margin: 15px 20px; border-radius: 10px;">
        <h3 style="color: #ffd700; margin: 0; font-size: 1.3rem;">üìã Live SEC Filings Stream</h3>
        <p style="opacity: 0.8; margin: 3px 0 0 0;">Latest filings from secapi.io - <button id="showAllFilings" style="background: rgba(255,215,0,0.2); border: 1px solid #ffd700; color: #ffd700; padding: 4px 12px; border-radius: 15px; cursor: pointer; font-size: 0.8rem; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,215,0,0.3)'" onmouseout="this.style.background='rgba(255,215,0,0.2)'">Show All</button></p>
    </div>

    <div class="filings-container" id="filingsContainer">
        <div class="no-filings">
            <h3>üöÄ Connecting to secapi.io...</h3>
            <p>Establishing WebSocket connection to real-time SEC filing stream</p>
        </div>
    </div>

    <div class="portfolio-toggle" id="portfolioToggle">
        üìä MY OLLYTRACKER PORTFOLIO
    </div>

    <div class="portfolio-panel" id="portfolioPanel">
        <div class="portfolio-panel-header">
            <h2 class="portfolio-panel-title">üéØ My OllyTracker<sup class="tm">‚Ñ¢</sup> Portfolio</h2>
            <button class="portfolio-close" id="portfolioClose">√ó</button>
        </div>
        
        <div class="portfolio-stats">
            <div class="portfolio-stat">
                <div class="portfolio-stat-number" id="portfolioCount">0</div>
                <div class="portfolio-stat-label">Companies</div>
            </div>
            <div class="portfolio-stat">
                <div class="portfolio-stat-number" id="portfolioActivityToday">0</div>
                <div class="portfolio-stat-label">Filings Today</div>
            </div>
            <div class="portfolio-stat">
                <div class="portfolio-stat-number" id="portfolioLastHour">0</div>
                <div class="portfolio-stat-label">Last Hour</div>
            </div>
        </div>
        
        <div class="portfolio-controls">
            <input type="text" class="portfolio-search" id="portfolioSearch" placeholder="Add ticker (e.g., AAPL)">
            <button class="portfolio-add-btn" id="portfolioAddBtn">+ Add</button>
        </div>
        
        <div class="portfolio-controls">
            <button class="portfolio-filter-btn" id="portfolioFilterBtn">üìä Show Portfolio Only</button>
        </div>
        
        <div class="portfolio-grid" id="portfolioGrid">
            <div class="portfolio-empty">
                <h3>üéØ Build Your Portfolio</h3>
                <p>Add companies to track their SEC filings in real-time</p>
                
                <div class="portfolio-suggestions">
                    <h4>üí° Popular Picks:</h4>
                    <div class="suggestion-chips">
                        <div class="suggestion-chip" onclick="secStream.quickAddToPortfolio('AAPL')">AAPL</div>
                        <div class="suggestion-chip" onclick="secStream.quickAddToPortfolio('MSFT')">MSFT</div>
                        <div class="suggestion-chip" onclick="secStream.quickAddToPortfolio('GOOGL')">GOOGL</div>
                        <div class="suggestion-chip" onclick="secStream.quickAddToPortfolio('AMZN')">AMZN</div>
                        <div class="suggestion-chip" onclick="secStream.quickAddToPortfolio('TSLA')">TSLA</div>
                        <div class="suggestion-chip" onclick="secStream.quickAddToPortfolio('META')">META</div>
                        <div class="suggestion-chip" onclick="secStream.quickAddToPortfolio('NVDA')">NVDA</div>
                        <div class="suggestion-chip" onclick="secStream.quickAddToPortfolio('JPM')">JPM</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <strong>New Filing</strong><br>
        <span id="notificationText"></span>
    </div>
    
    <script src="js/OllyEngine.js"></script>

    <!-- üö® Single Source Session Guard -->
<script>
(async () => {
  // Wait for shared Supabase client set by auth.js
  function waitForClient(maxAttempts = 60, interval = 200) {
    return new Promise((resolve, reject) => {
      let attempts = 0;
      const check = () => {
        if (window.supabaseClient) return resolve(window.supabaseClient);
        if (++attempts >= maxAttempts) return reject(new Error("Supabase client not ready"));
        setTimeout(check, interval);
      };
      check();
    });
  }

  function goLogin() {
    console.warn("[Auth] Redirecting to login");
    window.location.replace("/login.html");
  }

  try {
    const client = await waitForClient();

    // Try immediate session check
    let { data: { session }, error } = await client.auth.getSession();
    if (error) {
      console.error("[Auth] getSession error:", error);
    }

    if (session) {
      console.log("[Auth] ‚úÖ Session OK for:", session.user?.email);
    } else {
      console.log("[Auth] No active session yet, watching auth state...");
      // Wait to be told about real session
      const { data: listener } = client.auth.onAuthStateChange((event, newSession) => {
        if (event === "SIGNED_IN" && newSession) {
          console.log("[Auth] ‚úÖ Session arrived:", newSession.user?.email);
          listener.subscription.unsubscribe();
        } else if (event === "SIGNED_OUT") {
          console.warn("[Auth] Signed out -> to login");
          goLogin();
        }
      });

      // Fail‚Äësafe timeout: if nothing after 6s, redirect
      setTimeout(async () => {
        const { data: { session: retrySession } } = await client.auth.getSession();
        if (!retrySession) {
          console.warn("[Auth] Still no session, redirecting...");
          goLogin();
        }
      }, 6000);
    }

  } catch (err) {
    console.error("[Auth] Could not verify session:", err);
    goLogin();
  }
})();
</script>


    <!-- Existing inline JS continues -->
    <script>
      // ALL ORIGINAL JAVASCRIPT PRESERVED EXACTLY AS IS

    <script>
      // ALL ORIGINAL JAVASCRIPT PRESERVED EXACTLY AS IS
// Map filing form types to CSS class names for coloring
function getFormClass(formTypeRaw) {
  const ft = (formTypeRaw || '').toUpperCase().replace(/\s+/g,'');
  if (/^(FORM)?3(\/A|A|[-/].*)?$/.test(ft) || /^(FORM)?4(\/A|A|[-/].*)?$/.test(ft) || /^(FORM)?5(\/A|A|[-/].*)?$/.test(ft)) return 'badge-insider';
  if (ft === '144' || ft.startsWith('144/')) return 'badge-144';
  if (ft === '8-K' || ft === '8K' || /^8-K/i.test(formTypeRaw || '')) return 'badge-8k';
  if (ft === '10-K' || ft === '10K' || /^10-K/i.test(formTypeRaw || '')) return 'badge-10k';
  if (ft === '10-Q' || ft === '10Q' || /^10-Q/i.test(formTypeRaw || '')) return 'badge-10q';
  if (ft.startsWith('DEF14A')) return 'badge-def14a';
  if (ft.startsWith('SC13D') || ft === '13D' || ft.startsWith('13D/')) return 'badge-13d';
  if (ft.startsWith('SC13G') || ft === '13G' || ft.startsWith('13G/')) return 'badge-13g';
  if (ft.startsWith('13F') || ft === '13F' || ft.startsWith('13F/')) return 'badge-13f';
  if (ft.startsWith('S1') || ft.startsWith('S-1') || ft.startsWith('424B')) return 'badge-offering';
  return 'badge-default';
}
function getFormIcon(formTypeRaw){
  const ft = (formTypeRaw || '').toUpperCase();
  if (/^3|^4|^5|FORM 3|FORM 4|FORM 5/.test(ft)) return 'üë§';
  if (/^144/.test(ft)) return 'üîí';
  if (/^8-K/.test(ft)) return 'üß®';
  if (/^10-K/.test(ft)) return 'üìò';
  if (/^10-Q/.test(ft)) return 'üìó';
  if (/^DEF ?14A/.test(ft)) return 'üó≥Ô∏è';
  if (/13D/.test(ft)) return 'ü§ù';
  if (/13G/.test(ft)) return 'üìà';
  if (/13F/.test(ft)) return 'üß∫';
  if (/S-1|424B/i.test(ft)) return 'üöÄ';
  return 'üìÑ';
}

// OTCV - OllyTracker‚Ñ¢ Curriculum Vitae Function
async function showIndividualHistory(cik, name = 'Individual', searchByName = false) {
    
    // Create a modal immediately
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        z-index: 3000;
        display: flex;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(10px);
    `;
    
    const modalContent = document.createElement('div');
    modalContent.style.cssText = `
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        padding: 30px;
        border-radius: 15px;
        max-width: 900px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        color: white;
        border: 2px solid #ffd700;
        box-shadow: 0 20px 40px rgba(0,0,0,0.5);
    `;
    
    // Show loading state
    modalContent.innerHTML = `
        <h2 style="color: #ffd700; text-align: center;">
            üìä OTCV - OllyTracker<sup class="tm">‚Ñ¢</sup> Curriculum Vitae
        </h2>
        <p style="text-align: center; color: #90EE90;">Fetching Complete EDGAR History...</p>
        <p style="text-align: center;">${searchByName ? `Name: ${name}` : `CIK: ${cik}`}</p>
        <div style="text-align: center; margin: 20px;">
            <div class="spinner" style="border: 3px solid #f3f3f3; border-top: 3px solid #ffd700; 
                border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; 
                margin: 0 auto;"></div>
        </div>
    `;
    
    modal.appendChild(modalContent);
    document.body.appendChild(modal);
    
    try {
        // Build the search query based on whether we have a CIK or just a name
        let searchQuery;
        if (searchByName && name && name !== 'Individual' && name !== 'Reporting Person') {
            // Search by name in Forms 3, 4, 5
            searchQuery = {
                query: { 
                    query_string: { 
                        query: `"${name}" AND formType:(3 OR 4 OR 5)` 
                    }
                },
                from: "0",
                size: "200",
                sort: [{ filedAt: { order: "desc" } }]
            };
        } else if (cik) {
            // Search by CIK in reportingOwner fields or as company insider filings
            searchQuery = {
                query: { 
                    query_string: { 
                        query: `(reportingOwnerCik:"${cik}" OR (cik:"${cik}" AND formType:(3 OR 4 OR 5)))` 
                    }
                },
                from: "0",
                size: "200",
                sort: [{ filedAt: { order: "desc" } }]
            };
        } else {
            throw new Error('No valid search criteria provided');
        }
        
        // THE ACTUAL API CALL
        const response = await fetch('https://api.sec-api.io', {
            method: 'POST',
            headers: {
                'Authorization': 'fad7a2d6ac4447db3d2bdcd70003e2ea41ad47adedfd617fa4185c755fab3efd',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(searchQuery)
        });
        
        const data = await response.json();
        
        // Process the career data
        const careerMap = new Map();
        
        data.filings.forEach(filing => {
            const company = filing.ticker || filing.entityName || '';
            
            if (!careerMap.has(company)) {
                careerMap.set(company, {
                    companyName: filing.companyName,
                    positions: new Set(),
                    filings: [],
                    firstDate: filing.filedAt,
                    lastDate: filing.filedAt,
                    forms: new Map()
                });
            }
            
            const career = careerMap.get(company);
            career.filings.push(filing);
            
            // Count form types
            const formType = filing.formType || '';
            career.forms.set(formType, (career.forms.get(formType) || 0) + 1);
            
            // Track positions
            if (filing.reportingOwnerRelationship) {
                if (filing.reportingOwnerRelationship.isDirector) career.positions.add('Director');
                if (filing.reportingOwnerRelationship.isOfficer) career.positions.add('Officer');
                if (filing.reportingOwnerRelationship.isTenPercentOwner) career.positions.add('10% Owner');
                if (filing.reportingOwnerRelationship.officerTitle) {
                    career.positions.add(filing.reportingOwnerRelationship.officerTitle);
                }
            }
            
            // Update date range
            if (filing.filedAt < career.firstDate) career.firstDate = filing.filedAt;
            if (filing.filedAt > career.lastDate) career.lastDate = filing.filedAt;
        });
        
        // Build the display
        modalContent.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <h2 style="color: #ffd700; margin: 0;">üìä OTCV - OllyTracker<sup class="tm">‚Ñ¢</sup> Curriculum Vitae</h2>
                    <p style="margin: 5px 0; opacity: 0.9;">${name} - CIK: ${cik}</p>
                    <p style="margin: 5px 0; color: #90EE90;">‚úî ${data.total.value} Total Filings Found</p>
                </div>
                <button id="otcvCloseBtn" 
                    style="background: #dc3545; color: white; border: none; padding: 10px 15px; 
                    border-radius: 50%; cursor: pointer; font-size: 20px; font-weight: bold;">√ó</button>
            </div>
            
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #ffd700; margin-bottom: 15px;">üè¢ Career Timeline</h3>
                ${Array.from(careerMap.entries()).map(([ticker, career]) => `
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; 
                        margin-bottom: 15px; border-left: 3px solid #ffd700;">
                        
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h4 style="color: #ffd700; margin: 0;">
                                    ${ticker} ${career.companyName ? `- ${career.companyName}` : ''}
                                </h4>
                                <p style="margin: 5px 0; color: #90EE90;">
                                    ${Array.from(career.positions).join(', ') || 'Shareholder'}
                                </p>
                                <p style="margin: 5px 0; opacity: 0.8; font-size: 0.9rem;">
                                    ${career.firstDate} to ${career.lastDate} 
                                    (${career.filings.length} filings)
                                </p>
                                <p style="margin: 5px 0; opacity: 0.7; font-size: 0.85rem;">
                                    Forms: ${Array.from(career.forms.entries()).map(([form, count]) => 
                                        `${form} (${count})`
                                    ).join(', ')}
                                </p>
                            </div>
                            <button data-edgar-cik="${cik}"
                                style="background: #ffd700; color: #333; border: none; padding: 8px 15px; 
                                border-radius: 6px; cursor: pointer; font-weight: bold;">
                                View on EDGAR ‚Üí
                            </button>
                        </div>
                        
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #ffd700;">Show Recent Filings</summary>
                            <div style="margin-top: 10px; max-height: 200px; overflow-y: auto;">
                                ${career.filings.slice(0, 10).map(f => `
                                    <div style="padding: 5px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                        ${f.formType} - ${f.filedAt} 
                                        ${f.description ? `- ${f.description.substring(0, 50)}...` : ''}
                                        <a href="${f.linkToFilingDetails}" target="_blank" 
                                            style="color: #ffd700; text-decoration: none;">‚Üí</a>
                                    </div>
                                `).join('')}
                            </div>
                        </details>
                    </div>
                `).join('')}
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button id="otcvCopyCik"
                    style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); 
                    padding: 10px 20px; border-radius: 8px; cursor: pointer; margin: 5px;">
                    üìã Copy CIK
                </button>
                <button id="otcvOpenEdgar"
                    style="background: #ffd700; color: #333; border: none; padding: 10px 20px; 
                    border-radius: 8px; cursor: pointer; font-weight: bold; margin: 5px;">
                    üîó Open Full EDGAR Profile
                </button>
            </div>
        `;
        
        // Add event listeners after setting innerHTML
        const closeBtn = modalContent.querySelector('#otcvCloseBtn');
        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                modal.remove();
            });
        }
        
        const copyCikBtn = modalContent.querySelector('#otcvCopyCik');
        if (copyCikBtn) {
            copyCikBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(cik).then(() => {
                    alert('CIK copied!');
                });
            });
        }
        
        const openEdgarBtn = modalContent.querySelector('#otcvOpenEdgar');
        if (openEdgarBtn) {
            openEdgarBtn.addEventListener('click', () => {
                window.open(`https://www.sec.gov/cgi-bin/browse-edgar?CIK=${cik}&owner=include`, '_blank');
            });
        }
        
        // Add event listeners for all "View on EDGAR" buttons
        modalContent.querySelectorAll('[data-edgar-cik]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const btnCik = e.target.getAttribute('data-edgar-cik');
                window.open(`https://www.sec.gov/cgi-bin/browse-edgar?CIK=${btnCik}&owner=include`, '_blank');
            });
        });
        
    } catch (error) {
        modalContent.innerHTML = `
            <h3 style="color: #ff6b6b;">Error Loading OTCV</h3>
            <p>${error.message}</p>
            <button id="otcvErrorClose" 
                style="background: #dc3545; color: white; border: none; padding: 10px 20px; 
                border-radius: 8px; cursor: pointer; margin-top: 20px;">Close</button>
        `;
        
        const errorCloseBtn = modalContent.querySelector('#otcvErrorClose');
        if (errorCloseBtn) {
            errorCloseBtn.addEventListener('click', () => {
                modal.remove();
            });
        }
    }
    
    // Click outside to close
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.remove();
        }
    });
}

// REST OF THE ORIGINAL JAVASCRIPT CLASS CONTINUES HERE - EXACTLY AS IS
class SECFilingStream {
    constructor() {
        this.apiKey = 'fad7a2d6ac4447db3d2bdcd70003e2ea41ad47adedfd617fa4185c755fab3efd';
        this.wsEndpoint = `wss://stream.sec-api.io?apiKey=${this.apiKey}`;
        this.socket = null;
        this.isConnected = false;
        this.isPaused = false;
        this.soundEnabled = true;
        this.filings = [];
        this.portfolio = new Set();
        this.portfolioActivity = new Map();
        this.showAllFilings = false;
        this.connectionStartTime = null;
        this.activeFormTypeFilter = null;
        this.availableFormTypes = new Set();
        
        this.dailyStats = {
            total: 0,
            companies: new Set(),
            startTime: Date.now()
        };
        this.recentActivity = [];
        this.trendingData = new Map();
        this.isPortfolioFilterActive = false;
        this.tickerItems = [];
        
        this.filingIntelligence = {
            executive: [],
            insider: [],
            hostile: [],
            strategic: [],
            institutional: [],
            earnings: [],
            offerings: [],
            governance: []
        };
        this.intelligenceAlerts = {
            executive: true,
            insider: true,
            hostile: true,
            strategic: true,
            institutional: false,
            ipo: false
        };
        
        this.initializeEventListeners();
        this.startPeriodicUpdates();
        this.initializePortfolioPanel();
        this.initializeCompanyDatabases();
        this.startUptimeTimer();
    }

    async fetchStockPrice(ticker) {
        if (!ticker) return null;
        try {
            const response = await fetch(`https://finnhub.io/api/v1/quote?symbol=${ticker}&token=d296c09r01qhoena6il0d296c09r01qhoena6ilg`);
            if (!response.ok) return null;
            const data = await response.json();

            return {
                price: data.c || null,
                previousClose: data.pc || null,
            };
        } catch (err) {
            console.error(`Failed to fetch price for ${ticker}`, err);
            return null;
        }
    }

    initializeEventListeners() {
        document.getElementById('soundToggle').addEventListener('click', () => this.toggleSound());
        document.getElementById('pauseToggle').addEventListener('click', () => this.togglePause());
        document.getElementById('clearToggle').addEventListener('click', () => this.clearFilings());
        document.getElementById('showAllFilings').addEventListener('click', () => this.toggleShowAllFilings());
        
        document.getElementById('exchangeFilter').addEventListener('change', () => this.applyFilters());
        document.getElementById('indexFilter').addEventListener('change', () => this.applyFilters());
        document.getElementById('formFilter').addEventListener('change', () => this.applyFilters());
    }

    connect() {
        this.updateStatus('Connecting to secapi.io...', 'connecting');
        this.updateApiStatus('Establishing WebSocket connection...');
        
        try {
            // Close existing connection if any
            if (this.socket && this.socket.readyState !== WebSocket.CLOSED) {
                this.socket.close();
            }
            
            this.socket = new WebSocket(this.wsEndpoint);
            
            this.socket.onopen = (event) => {
                this.isConnected = true;
                this.connectionStartTime = Date.now();
                this.updateStatus('Connected - Live EDGAR stream active', 'connected');
                this.updateApiStatus('Connected - Receiving live data');
                
                // Don't clear existing filings on reconnect - preserve history
                if (this.filings.length === 0) {
                    document.getElementById('filingsContainer').innerHTML = '';
                }
            };

            this.socket.onmessage = (event) => {
                if (!this.isPaused) {
                    try {
                        const filings = JSON.parse(event.data);
                        
                        if (Array.isArray(filings)) {
                            filings.forEach(filing => {
                                this.processFiling(filing);
                            });
                        }
                        
                    } catch (error) {
                        console.error('Error parsing filing data:', error);
                        // Don't refresh page on parse errors
                    }
                }
            };

            this.socket.onerror = (error) => {
                console.error('WebSocket error:', error);
                this.updateStatus('Connection interrupted - Reconnecting automatically...', 'connecting');
                this.updateApiStatus('Connection error - Will retry automatically');
                this.showNotification('‚ö†Ô∏è Connection interrupted. Reconnecting without losing data...');
                
                // Don't refresh page - just mark as disconnected and retry
                this.isConnected = false;
            };

            this.socket.onclose = (event) => {
                this.isConnected = false;
                
                if (event.code !== 1000) { // Not a clean close
                    this.updateStatus('Connection lost - Reconnecting automatically...', 'connecting');
                    this.updateApiStatus('Reconnecting - Data history preserved');
                    this.showNotification('üîÑ Reconnecting to secapi.io... Your streaming history is preserved.');
                    
                    // Auto-reconnect without page refresh
                    setTimeout(() => {
                        if (!this.isConnected) {
                            this.connect();
                        }
                    }, 3000);
                } else {
                    this.updateStatus('Disconnected', 'error');
                    this.updateApiStatus('Disconnected');
                }
            };

        } catch (error) {
            console.error('Failed to establish WebSocket connection:', error);
            this.updateStatus('Connection failed - Will retry automatically', 'error');
            this.updateApiStatus('Connection failed - Retrying...');
            this.showNotification('‚ùå Failed to connect. Retrying automatically...');
            
            // Retry connection without page refresh
            setTimeout(() => {
                this.connect();
            }, 5000);
        }
    }

    processFiling(filing) {
        // Check if this is an insider filing (Forms 3, 4, 5) - check various formats
        const formTypeStr = (filing.formType || '').toString();
        const normForm = (filing.formType || '').toString().toUpperCase().replace(/\s+/g,'');
        const isInsiderFiling = /^(FORM)?(3|4|5)(?:$|\/A$|A$|[-/].*)/.test(normForm);
        const hasIndividualCik = !!(filing?.reportingOwnerCik || filing?.reportingOwner?.cik || (Array.isArray(filing?.reportingOwners) && filing.reportingOwners.length > 0));
        
        const filingData = {
            ...filing,
            receivedAt: Date.now(),
            priority: this.calculatePriority(filing),
            exchange: this.getExchange(filing.ticker),
            sector: this.getSector(filing.ticker),
            marketCap: this.getMarketCap(filing.ticker),
            indices: this.getIndices(filing.ticker),
            isPortfolioCompany: this.portfolio.has(filing.ticker),
            // Check for individual CIK fields - Forms 3, 4, 5 always have reporting owners
            hasIndividualCik: isInsiderFiling || !!(filing.reportingOwnerCik || filing.reportingOwner?.cik || filing.reportingOwners),
            isInsiderFiling: isInsiderFiling
        };

        // ADD THESE 7 LINES RIGHT HERE!!!
        // Show notification for this filing
        document.getElementById('notificationText').innerHTML = `${filing.formType || filing.type || ''}`;
        document.getElementById('notification').classList.add('show');
        
        // Hide notification after 5 seconds
        setTimeout(function() {
            document.getElementById('notification').classList.remove('show');
        }, 5000);

        // Fetch stock price asynchronously and update display when ready
        this.fetchStockPrice(filing.ticker).then(price => {
            if (price && price.price !== null && price.previousClose !== null) {
                filingData.stockPrice = price.price;
                filingData.stockUp = price.price > price.previousClose;
            }
            // Update display with price info if available
            this.updateFilingDisplay(filingData);
        });

        // If it's an insider filing, log it for debugging
        if (isInsiderFiling) {
            console.log('üìä Insider Filing Detected:', {
                formType: filing.formType,
                ticker: filing.ticker,
                company: filing.companyName,
                reportingOwner: filing.reportingOwnerName || filing.reportingOwner || 'N/A'
            });
        }
        
        // Continue with the rest of the processing immediately
        this.updateDailyStats(filingData);
        this.updateTrending(filingData);
        this.updateTicker(filingData);
        this.trackFormType(filingData.formType);
        this.updateFormTypeButtonGlow();
        this.categorizeFilingForIntelligence(filingData);

        if (filingData.isPortfolioCompany) {
            this.trackPortfolioActivity(filingData);
        }
    }

    updateFilingDisplay(filingData) {
        // Check if card already exists
        const existingCard = document.querySelector(`[data-ticker="${filingData.ticker}"][data-form="${filingData.formType}"]`);
        if (!existingCard) {
            this.displayFiling(filingData);
        }

        if (this.filings.length > 50) {
            this.filings = this.filings.slice(0, 50);
            this.removeOldestFilingCard();
        }

        this.filings.unshift(filingData);
        
        if (filingData.isPortfolioCompany && this.soundEnabled) {
            this.showPortfolioNotification(filingData);
            this.playPortfolioNotificationSound();
        } else if (filingData.priority === 'urgent' && this.soundEnabled) {
            this.playNotificationSound();
        }

        this.updatePortfolioStats();
    }

    trackFormType(formType) {
        if (!formType) return;
        
        const formTypeStr = formType.toString();
        this.availableFormTypes.add(formTypeStr);
        
        // Track insider forms specially
        if (formTypeStr === '3' || formTypeStr.includes('3') && formTypeStr.length <= 6) {
            this.availableFormTypes.add('3');
        }
        if (formTypeStr === '4' || formTypeStr.includes('4') && formTypeStr.length <= 6) {
            this.availableFormTypes.add('4');
        }
        if (formTypeStr === '5' || formTypeStr.includes('5') && formTypeStr.length <= 6) {
            this.availableFormTypes.add('5');
        }
        
        if (formType === '13D' || formType === '13G') {
            this.availableFormTypes.add('13D');
            this.availableFormTypes.add('13G');
        } else if (formType.includes('14A')) {
            this.availableFormTypes.add('DEF 14A');
        } else if (formType === '13F-HR') {
            this.availableFormTypes.add('13F');
        } else if (formType === 'FORM-D') {
            this.availableFormTypes.add('D');
        }
    }

    updateFormTypeButtonGlow() {
        const formTypeToClass = {
            '10-K': 'annual',
            '10-Q': 'quarterly', 
            '8-K': 'current',
            '3': 'initial',
            '4': 'insider',
            '5': 'insider-annual',
            '13F': 'institutional',
            'DEF 14A': 'proxy',
            'S-1': 'registration',
            'D': 'private',
            '13D': 'beneficial',
            '144': 'sales'
        };

        Object.entries(formTypeToClass).forEach(([formType, buttonClass]) => {
            const button = document.querySelector(`.form-type-btn.${buttonClass}`);
            if (button) {
                const hasFilings = this.availableFormTypes.has(formType) || 
                                 (formType === '3' && Array.from(this.availableFormTypes).some(type => type === '3' || type.includes('3') && type.length <= 6)) ||
                                 (formType === '4' && Array.from(this.availableFormTypes).some(type => type === '4' || type.includes('4') && type.length <= 6)) ||
                                 (formType === '5' && Array.from(this.availableFormTypes).some(type => type === '5' || type.includes('5') && type.length <= 6)) ||
                                 (formType === '13D' && (this.availableFormTypes.has('13D') || this.availableFormTypes.has('13G'))) ||
                                 (formType === 'DEF 14A' && Array.from(this.availableFormTypes).some(type => type.includes('14A'))) ||
                                 (formType === '13F' && (this.availableFormTypes.has('13F') || this.availableFormTypes.has('13F-HR'))) ||
                                 (formType === 'D' && (this.availableFormTypes.has('D') || this.availableFormTypes.has('FORM-D')));
                
                if (hasFilings) {
                    button.classList.add('has-filings');
                } else {
                    button.classList.remove('has-filings');
                }
            }
        });

        const allButton = document.querySelector('.form-type-btn.all');
        if (allButton && this.availableFormTypes.size > 0) {
            allButton.classList.add('has-filings');
        }
    }

    updateTicker(filing) {
        const tickerContent = document.getElementById('tickerContent');
        
        const tickerItem = document.createElement('div');
        tickerItem.className = 'ticker-item';
        const properFormType = this.getProperFormType(filing.formType);
        tickerItem.innerHTML = `
            <span class="ticker-ticker">${filing.ticker || ' '}</span>
            <span class="ticker-form">${properFormType}</span>
            - ${filing.companyName || 'Unknown Company'}
        `;
        
        tickerItem.addEventListener('click', () => {
            this.showFilingDetails(filing);
        });
        
        this.tickerItems.unshift({element: tickerItem, data: filing});
        
        if (this.tickerItems.length > 10) {
            this.tickerItems = this.tickerItems.slice(0, 10);
        }
        
        tickerContent.innerHTML = '';
        this.tickerItems.forEach(item => {
            tickerContent.appendChild(item.element.cloneNode(true));
            tickerContent.lastChild.addEventListener('click', () => {
                this.showFilingDetails(item.data);
            });
        });
    }

    showFilingDetails(filing) {
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        `;
        
        const modalContent = document.createElement('div');
        modalContent.style.cssText = `
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            color: white;
            border: 2px solid #ffd700;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        `;
        
        const properFormType = this.getProperFormType(filing.formType);
        
        // Check if this is an insider filing (Forms 3, 4, 5) - check various formats
        const formTypeStr = (filing.formType || '').toString();
        const normForm = (filing.formType || '').toString().toUpperCase().replace(/\s+/g,'');
        const isInsiderFiling = /^(FORM)?(3|4|5)(?:$|\/A$|A$|[-/].*)/.test(normForm);
        const hasIndividual = !!(filing?.reportingOwnerCik || filing?.reportingOwner?.cik || (Array.isArray(filing?.reportingOwners) && filing.reportingOwners.length > 0));
        
        // Get individual CIK - for insider filings, we can use the company CIK to search for the individual
        const individualCik = filing.reportingOwnerCik || filing.reportingOwner?.cik || 
                            (isInsiderFiling ? filing.cik : null);
        
        // OTCV button shows for ALL Forms 3, 4, 5
        const otcvButton = (isInsiderFiling && hasIndividual) ? `
            <button id="otcvBtn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                color: #ffd700; border: 2px solid #ffd700; padding: 10px 20px; border-radius: 8px; 
                cursor: pointer; font-weight: bold;" title="View individual's complete filing history across all companies">
                üë§ Individual OTCV History
            </button>
        ` : '';
        
        modalContent.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: #ffd700; margin: 0;">${filing.ticker ? filing.ticker + ' - ' : ''}${filing.formType}</h2>
                <button id="closeModal" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 50%; cursor: pointer; font-size: 16px;">√ó</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <h3 style="color: #ffd700; margin-bottom: 10px;">${filing.companyName || 'Unknown Company'}</h3>
                ${filing.reportingOwnerName ? `<p><strong>Reporting Person:</strong> ${filing.reportingOwnerName}</p>` : ''}
                ${isInsiderFiling && !filing.reportingOwnerName ? `<p style="color: #90EE90;">‚ÑπÔ∏è This is an insider filing (Form ${filing.formType})</p>` : ''}
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                    <div><strong>CIK:</strong> ${filing.cik}</div>
                    <div><strong>Filed:</strong> ${OllyEngine.Utils.formatTime(filing.filedAt)}</div>
                    <div><strong>Form Type:</strong> </div>
    <button class="form-badge ${getFormClass(filing.formType)}" type="button">${properFormType}</button>
                    <div><strong>Accession:</strong> ${filing.accessionNo}</div>
                    ${filing.periodOfReport ? `<div><strong>Period:</strong> ${filing.periodOfReport}</div>` : ''}
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button id="viewFilingBtn" style="background: #ffd700; color: #333; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold;">
                    üìÑ View Filing
                </button>
                ${!isInsiderFiling ? `
                <button id="viewCompanyBtn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 10px 20px; border-radius: 8px; cursor: pointer;">
                    üè¢ Company Profile
                </button>
                ` : ''}
                <button id="portfolioActionBtn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 10px 20px; border-radius: 8px; cursor: pointer;">
                    üìä ${this.portfolio.has(filing.ticker) ? 'Remove from Portfolio' : 'Add to Portfolio'}
                </button>
                ${otcvButton}
            </div>
        `;
        
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        modalContent.querySelector('#viewFilingBtn').addEventListener('click', () => {
            this.viewFiling(filing.linkToFilingDetails);
        });
        
        const viewCompanyBtn = modalContent.querySelector('#viewCompanyBtn');
        if (viewCompanyBtn) {
            viewCompanyBtn.addEventListener('click', () => {
                this.viewCompanyProfile(filing.cik);
            });
        }
        
        modalContent.querySelector('#portfolioActionBtn').addEventListener('click', () => {
            if (this.portfolio.has(filing.ticker)) {
                this.removeFromPortfolio(filing.ticker);
            } else {
                this.addToPortfolio(filing.ticker);
            }
            
            const btn = modalContent.querySelector('#portfolioActionBtn');
            btn.textContent = this.portfolio.has(filing.ticker) ? 'üìä Remove from Portfolio' : 'üìä Add to Portfolio';
            
            setTimeout(() => {
                document.body.removeChild(modal);
            }, 1000);
        });
        
        // Add OTCV button handler if it exists (for Forms 3, 4, 5)
        if (isInsiderFiling) {
            const otcvBtnElement = modalContent.querySelector('#otcvBtn');
            if (otcvBtnElement) {
                otcvBtnElement.addEventListener('click', () => {
                    const individualName = filing.reportingOwnerName || filing.reportingOwner?.name || 'Individual';
                    // Check if we have a real individual CIK
                    const hasIndividualCik = filing.reportingOwnerCik || filing.reportingOwner?.cik;
                    const searchByName = !hasIndividualCik && individualName && individualName !== 'Individual' && individualName !== 'Reporting Person';
                    
                    showIndividualHistory(individualCik, individualName, searchByName);
                    document.body.removeChild(modal);
                });
            }
        }
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                document.body.removeChild(modal);
            }
        });
        
        modalContent.querySelector('#closeModal').addEventListener('click', () => {
            document.body.removeChild(modal);
        });
    }

    displayFiling(filing) {
        const container = document.getElementById('filingsContainer');
        
        if (container.querySelector('.no-filings')) {
            container.innerHTML = '';
        }

        const card = document.createElement('div');
        card.className = 'filing-card';
        // Make entire card clickable (ignore clicks on buttons/links/inputs)
        card.addEventListener('click', (ev) => {
            const t = ev.target;
            if (t.closest('button, a, input, textarea, select')) return;
            try { this.showFilingDetails(filing); } catch (e) { console.error('showFilingDetails failed:', e); }
        });
        
        card.setAttribute('data-priority', filing.priority);
        card.setAttribute('data-form', filing.formType);
        card.setAttribute('data-exchange', filing.exchange);
        card.setAttribute('data-sector', filing.sector);
        card.setAttribute('data-market-cap', filing.marketCap);
        card.setAttribute('data-indices', filing.indices.join(','));
        card.setAttribute('data-ticker', filing.ticker);
        
        if (filing.isPortfolioCompany) {
            card.classList.add('portfolio-company-filing');
        }
        
        if (filing.priority === 'urgent') {
            card.innerHTML = '<div class="hot-badge">üî• HOT</div>';
        }

        const indexBadges = filing.indices.map(index => {
            const badges = {
                'SP500': 'üèÜ S&P 500',
                'NASDAQ100': 'üíª NASDAQ 100', 
                'DOW30': 'üìà Dow 30'
            };
            return `<span class="index-badge">${badges[index] || index}</span>`;
        }).join('');

        const exchangeBadge = filing.exchange !== 'OTC' ? 
            `<span class="exchange-badge">üìä ${filing.exchange}</span>` : '';

        const portfolioBadge = filing.isPortfolioCompany ? 
            `<span class="index-badge" style="background: rgba(255,215,0,0.3); color: #ffd700;">üìä Portfolio</span>` : '';

        const properFormType = this.getProperFormType(filing.formType);
        
        // Check if this is an insider filing (Forms 3, 4, 5) - check various formats
        const formTypeStr = (filing.formType || '').toString();
        const isInsiderFiling = ['3', '4', '5'].includes(formTypeStr) || 
                              formTypeStr.includes('3') && formTypeStr.length <= 6 ||
                              formTypeStr.includes('4') && formTypeStr.length <= 6 ||
                              formTypeStr.includes('5') && formTypeStr.length <= 6 ||
                              formTypeStr.toLowerCase().includes('form 3') ||
                              formTypeStr.toLowerCase().includes('form 4') ||
                              formTypeStr.toLowerCase().includes('form 5');
        
        // Get individual CIK and name - for insider filings, use company CIK if individual CIK not available
        const individualCik = filing.reportingOwnerCik || filing.reportingOwner?.cik || 
                            (isInsiderFiling ? filing.cik : null);
        const individualName = filing.reportingOwnerName || filing.reportingOwner?.name || 
                             (isInsiderFiling ? 'Reporting Person' : null);
        
        // Add OTCV button for ALL insider filings (Forms 3, 4, 5)
        const otcvButton = isInsiderFiling ? `
            <button class="action-btn otcv" 
                data-action="show-otcv" 
                data-cik="${individualCik}"
                data-name="${individualName || 'Individual'}"
                title="View individual's complete EDGAR filing history across all companies">
                üë§ Individual OTCV
            </button>
        ` : '';

        card.innerHTML += `
            <div class="filing-header">
                <div class="company-info">
                    <div class="ticker" onclick="secStream.viewStockPrice('${filing.ticker}')" title="Click to view ${filing.ticker} on Yahoo Finance">${filing.ticker || ' '}</div>
                    ${filing.stockPrice !== undefined
                      ? `<div style="color:${filing.stockUp ? '#00ff88' : '#ff9999'}; font-size:0.85rem; font-weight:600;">${filing.stockUp ? '‚Üë' : '‚Üì'} ${filing.stockPrice.toFixed(2)}</div>`
                      : ''
                    }
                    <div class="company-name">${OllyEngine.Utils.truncateCompanyName(filing.companyName)}</div>
                    ${individualName && isInsiderFiling ? `<div style="font-size: 0.75rem; color: #90EE90; margin-top: 2px;">üìã ${individualName}</div>` : ''}
                    <div class="company-badges">
                        ${portfolioBadge}
                        ${exchangeBadge}
                        ${indexBadges}
                    </div>
                </div>
                <div class="form-type"></div>
    <button class="form-badge ${getFormClass(filing.formType)}" type="button">${properFormType}</button>
            </div>
            
            <div class="filing-details">
                <div class="detail-row">
                    <span class="detail-label">Filed:</span>
                    <span class="detail-value filed-time">${OllyEngine.Utils.formatTime(filing.filedAt)}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Sector:</span>
                    <span class="detail-value">${filing.sector}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">CIK:</span>
                    <span class="detail-value">${filing.cik}</span>
                </div>
                ${filing.periodOfReport ? `
                <div class="detail-row">
                    <span class="detail-label">Period:</span>
                    <span class="detail-value">${filing.periodOfReport}</span>
                </div>
                ` : ''}
            </div>
            
            <div class="filing-actions">
                <button class="action-btn primary" data-action="view-filing" data-url="${filing.linkToFilingDetails}">
                    üìÑ View Filing
                </button>
                ${!isInsiderFiling ? `
                <button class="action-btn" data-action="view-company" data-cik="${filing.cik}">
                    üè¢ Company Profile
                </button>
                ` : ''}
                <button class="action-btn portfolio-btn" data-action="toggle-portfolio" data-ticker="${filing.ticker}">
                    ${filing.isPortfolioCompany ? 'üìä Remove' : 'üìä Add to Portfolio'}
                </button>
                ${otcvButton}
            </div>
        `;

        this.addFilingCardEventListeners(card, filing);

        container.insertBefore(card, container.firstChild);
        this.refreshFilingDisplay();
    }

    addFilingCardEventListeners(card, filing) {
        const viewFilingBtn = card.querySelector('[data-action="view-filing"]');
        const viewCompanyBtn = card.querySelector('[data-action="view-company"]');
        const portfolioBtn = card.querySelector('[data-action="toggle-portfolio"]');
        const otcvBtn = card.querySelector('[data-action="show-otcv"]');

        if (viewFilingBtn) {
            viewFilingBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                this.viewFiling(filing.linkToFilingDetails);
            });
        }

        if (viewCompanyBtn) {
            viewCompanyBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                this.viewCompanyProfile(filing.cik);
            });
        }

        if (portfolioBtn) {
            portfolioBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const ticker = filing.ticker;
                if (this.portfolio.has(ticker)) {
                    this.removeFromPortfolio(ticker);
                } else {
                    this.addToPortfolio(ticker);
                }
                
                portfolioBtn.textContent = this.portfolio.has(ticker) ? 'üìä Remove' : 'üìä Add to Portfolio';
                
                if (this.portfolio.has(ticker)) {
                    card.classList.add('portfolio-company-filing');
                } else {
                    card.classList.remove('portfolio-company-filing');
                }
            });
        }
        
        // Add OTCV button handler for insider filings
        if (otcvBtn) {
            otcvBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const cik = otcvBtn.getAttribute('data-cik');
                const name = otcvBtn.getAttribute('data-name');
                
                // For Forms 3, 4, 5 without individual CIK, search by name
                const isInsiderFiling = ['3', '4', '5'].includes(filing.formType) || 
                                      (filing.formType && filing.formType.toString().match(/^(form\s*)?(3|4|5)$/i));
                
                // If we don't have a reportingOwnerCik but have a name, search by name
                const hasIndividualCik = filing.reportingOwnerCik || filing.reportingOwner?.cik;
                const searchByName = isInsiderFiling && !hasIndividualCik && name && name !== 'Individual' && name !== 'Reporting Person';
                
                showIndividualHistory(cik, name, searchByName);
            });
        }
    }

    updateDailyStats(filing) {
        this.dailyStats.total++;
        if (filing.cik) {
            this.dailyStats.companies.add(filing.cik);
        }
        
        const now = Date.now();
        this.recentActivity.push(now);
        this.recentActivity = this.recentActivity.filter(time => now - time < 60000);
        
        document.getElementById('totalFilings').textContent = this.dailyStats.total;
        document.getElementById('filingRate').textContent = this.recentActivity.length;
        document.getElementById('uniqueCompanies').textContent = this.dailyStats.companies.size;
    }

    updateStatus(message, status) {
        document.getElementById('statusText').textContent = message;
        const indicator = document.getElementById('statusIndicator');
        indicator.className = `status-indicator ${status}`;
    }

    updateApiStatus(status) {
        document.getElementById('apiStatus').textContent = status;
    }

    startUptimeTimer() {
        setInterval(() => {
            if (this.connectionStartTime) {
                const uptime = Date.now() - this.connectionStartTime;
                const hours = Math.floor(uptime / 3600000);
                const minutes = Math.floor((uptime % 3600000) / 60000);
                const seconds = Math.floor((uptime % 60000) / 1000);
                
                document.getElementById('uptime').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }, 1000);
    }

    // All other methods remain the same...
    initializeCompanyDatabases() {
        this.FORTUNE50 = [
            'WMT', 'AMZN', 'AAPL', 'CVX', 'UNH', 'GOOG', 'XOM', 'BRK.A', 'MSFT', 'MCK',
            'ABC', 'CVS', 'TGT', 'COR', 'CAH', 'HD', 'WBA', 'JPM', 'VZ', 'GM',
            'BAC', 'F', 'CNC', 'KR', 'META', 'COST', 'TSLA', 'ADM', 'FDX', 'PFE',
            'UPS', 'LMT', 'JNJ', 'GE', 'IBM', 'WFC', 'RTX', 'C', 'INTC', 'HPQ',
            'DIS', 'ORCL', 'DELL', 'MS', 'AIG', 'CAT', 'BA', 'LOW', 'MCD', 'PG'
        ];

        this.SP500 = new Set([
            'AAPL', 'MSFT', 'GOOGL', 'GOOG', 'AMZN', 'TSLA', 'META', 'NVDA', 'JPM', 'JNJ',
            'V', 'PG', 'HD', 'MA', 'BAC', 'ABBV', 'PFE', 'KO', 'AVGO', 'PEP', 'COST', 'TMO',
            'MRK', 'ABT', 'NFLX', 'ADBE', 'WMT', 'CRM', 'ACN', 'VZ', 'CMCSA', 'DHR', 'NKE'
        ]);

        this.NASDAQ100 = new Set([
            'AAPL', 'MSFT', 'GOOGL', 'GOOG', 'AMZN', 'TSLA', 'META', 'NVDA', 'AVGO', 'PEP',
            'COST', 'NFLX', 'ADBE', 'CRM', 'TXN', 'QCOM', 'INTU', 'ISRG', 'AMGN', 'AMD'
        ]);

        this.DOW30 = new Set([
            'AAPL', 'MSFT', 'UNH', 'GS', 'HD', 'CAT', 'CRM', 'MCD', 'V', 'BA', 'AXP', 'JPM'
        ]);

        this.exchangeMap = {
            'AAPL': 'NASDAQ', 'MSFT': 'NASDAQ', 'GOOGL': 'NASDAQ', 'AMZN': 'NASDAQ',
            'JPM': 'NYSE', 'JNJ': 'NYSE', 'V': 'NYSE', 'PG': 'NYSE', 'HD': 'NYSE'
        };

        this.sectorMap = {
            'AAPL': 'Technology', 'MSFT': 'Technology', 'GOOGL': 'Technology',
            'JPM': 'Financial', 'JNJ': 'Healthcare', 'V': 'Financial'
        };

        this.marketCapMap = {
            'AAPL': 'mega', 'MSFT': 'mega', 'GOOGL': 'mega', 'AMZN': 'mega'
        };
    }

    getExchange(ticker) {
        return this.exchangeMap[ticker] || 'OTC';
    }

    getSector(ticker) {
        return this.sectorMap[ticker] || 'Other';
    }

    getMarketCap(ticker) {
        return this.marketCapMap[ticker] || 'small';
    }

    getIndices(ticker) {
        const indices = [];
        if (this.SP500.has(ticker)) indices.push('SP500');
        if (this.NASDAQ100.has(ticker)) indices.push('NASDAQ100');
        if (this.DOW30.has(ticker)) indices.push('DOW30');
        return indices;
    }

    getProperFormType(formType) {
        if (!formType || formType === ' ' || formType === null || formType === undefined) {
            return '';
        }
        
        const cleanFormType = formType.toString().trim().replace(/[\/\-\s]+/g, '-');
        
        const formTypeMap = {
            '10-K': '10-K (Annual Report)',
            '10-Q': '10-Q (Quarterly Report)', 
            '8-K': '8-K (Current Report)',
            '4': 'Form 4 (Insider Trading)',
            '3': 'Form 3 (Initial Ownership)',
            '5': 'Form 5 (Annual Statement)',
            '144': 'Form 144 (Notice of Sale)',
            '13F-HR': '13F (Institutional Holdings)',
            '13F': '13F (Institutional Holdings)',
            '13D': '13D (Beneficial Ownership)',
            '13G': '13G (Beneficial Ownership)',
            'DEF-14A': 'DEF 14A (Proxy Statement)',
            'DEF 14A': 'DEF 14A (Proxy Statement)',
            'S-1': 'S-1 (Registration)',
            'S-3': 'S-3 (Registration)',
            'S-4': 'S-4 (Registration)',
            'S-8': 'S-8 (Employee Plans)',
            'SC-13D': 'SC 13D (Tender Offer)',
            'SC-13G': 'SC 13G (Tender Offer)',
            'SC-TO': 'SC TO (Tender Offer)',
            'PREM14A': 'PREM14A (Preliminary Proxy)',
            'DEFA14A': 'DEFA14A (Additional Proxy)',
            '20-F': '20-F (Foreign Annual)',
            '6-K': '6-K (Foreign Report)',
            'F-1': 'F-1 (Foreign Registration)',
            'F-3': 'F-3 (Foreign Registration)',
            'F-4': 'F-4 (Foreign Registration)',
            'NT-10K': 'NT 10K (Late Filing Notice)',
            'NT-10Q': 'NT 10Q (Late Filing Notice)',
            '11-K': '11-K (Employee Plan)',
            'FORM-D': 'Form D (Private Offering)',
            'D': 'Form D (Private Offering)',
            '497': 'Form 497 (Fund Prospectus)',
            'N-Q': 'Form N-Q (Fund Holdings)',
            'N-CSR': 'Form N-CSR (Fund Report)',
            'N-CSRS': 'Form N-CSRS (Fund Report)',
            'PX14A6G': 'PX14A6G (Proxy Solicitation)',
            '425': 'Form 425 (Prospectus)',
            'UPLOAD': 'Document Upload',
            '485BPOS': '485BPOS (Fund Registration)',
            // Make sure insider forms are recognized
            'FORM 3': 'Form 3 (Initial Ownership)',
            'FORM 4': 'Form 4 (Insider Trading)',
            'FORM 5': 'Form 5 (Annual Statement)',
            'FORM-3': 'Form 3 (Initial Ownership)',
            'FORM-4': 'Form 4 (Insider Trading)',
            'FORM-5': 'Form 5 (Annual Statement)'
        };
        
        return formTypeMap[cleanFormType] || formType;
    }

    calculatePriority(filing) {
        const urgentForms = ['8-K', '4', '13F', 'DEF 14A'];
        const insiderForms = ['3', '4', '5'];
        const largeTickers = ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA', 'META', 'NVDA'];
        
        // Check if it's an insider filing
        const formTypeStr = (filing.formType || '').toString();
        const isInsiderFiling = insiderForms.some(form => 
            formTypeStr === form || 
            formTypeStr.includes(form) && formTypeStr.length <= 6
        );
        
        if ((urgentForms.includes(filing.formType) || isInsiderFiling) && largeTickers.includes(filing.ticker)) {
            return 'urgent';
        } else if (urgentForms.includes(filing.formType) || isInsiderFiling || largeTickers.includes(filing.ticker)) {
            return 'high';
        }
        return 'normal';
    }

    viewFiling(url) {
        if (url) {
            window.open(url, '_blank');
        } else {
            this.showNotification('‚ùå Filing URL not available');
        }
    }

    viewCompanyProfile(cik) {
        if (cik) {
            const secUrl = `https://www.sec.gov/cgi-bin/browse-edgar?CIK=${cik}&owner=exclude&action=getcompany`;
            window.open(secUrl, '_blank');
        } else {
            this.showNotification('‚ùå Company CIK not available');
        }
    }

    viewStockPrice(ticker) {
        if (ticker) {
            const yahooUrl = `https://finance.yahoo.com/quote/${ticker}`;
            window.open(yahooUrl, '_blank');
        }
    }

    showNotification(message) {
        const notification = document.getElementById('notification');
        document.getElementById('notificationText').textContent = message;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 5000);
    }

    toggleSound() {
        this.soundEnabled = !this.soundEnabled;
        const btn = document.getElementById('soundToggle');
        btn.textContent = this.soundEnabled ? 'üîä Sound On' : 'üîá Sound Off';
        btn.classList.toggle('active', this.soundEnabled);
    }

    togglePause() {
        this.isPaused = !this.isPaused;
        const btn = document.getElementById('pauseToggle');
        btn.textContent = this.isPaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
        btn.classList.toggle('active', this.isPaused);
        
        if (this.isPaused) {
            this.showNotification('‚è∏Ô∏è Stream paused - filings will buffer');
        } else {
            this.showNotification('‚ñ∂Ô∏è Stream resumed');
        }
    }

    clearFilings() {
        this.filings = [];
        this.availableFormTypes.clear();
        
        document.getElementById('filingsContainer').innerHTML = `
            <div class="no-filings">
                <h3>üßπ Cleared!</h3>
                <p>Waiting for new filings from secapi.io...</p>
            </div>
        `;
        
        document.querySelectorAll('.form-type-btn').forEach(btn => {
            btn.classList.remove('has-filings');
        });
        
        this.showNotification('üßπ Filing display cleared');
    }

    toggleShowAllFilings() {
        this.showAllFilings = !this.showAllFilings;
        const btn = document.getElementById('showAllFilings');
        btn.textContent = this.showAllFilings ? 'Show Latest 4' : 'Show All';
        this.refreshFilingDisplay();
    }

    refreshFilingDisplay() {
        const container = document.getElementById('filingsContainer');
        const cards = container.querySelectorAll('.filing-card');
        
        cards.forEach((card, index) => {
            if (this.showAllFilings) {
                card.style.display = 'block';
            } else {
                card.style.display = index < 4 ? 'block' : 'none';
            }
        });
    }

    removeOldestFilingCard() {
        const container = document.getElementById('filingsContainer');
        const cards = container.querySelectorAll('.filing-card');
        if (cards.length > 50) {
            cards[cards.length - 1].remove();
        }
    }

    applyFilters() {
        const formFilter = document.getElementById('formFilter').value;
        const exchangeFilter = document.getElementById('exchangeFilter').value;
        const indexFilter = document.getElementById('indexFilter').value;
        
        const cards = document.querySelectorAll('.filing-card');
        let visibleCount = 0;
        
        cards.forEach(card => {
            let show = true;
            
            if (this.isPortfolioFilterActive) {
                const ticker = card.getAttribute('data-ticker');
                if (!this.portfolio.has(ticker)) {
                    show = false;
                }
            }
            
            if (show && this.activeFormTypeFilter) {
                const cardFormType = card.getAttribute('data-form');
                
                if (this.activeFormTypeFilter === '3' && (cardFormType === '3' || cardFormType.includes('3') && cardFormType.length <= 6)) {
                    show = true;
                } else if (this.activeFormTypeFilter === '4' && (cardFormType === '4' || cardFormType.includes('4') && cardFormType.length <= 6)) {
                    show = true;
                } else if (this.activeFormTypeFilter === '5' && (cardFormType === '5' || cardFormType.includes('5') && cardFormType.length <= 6)) {
                    show = true;
                } else if (this.activeFormTypeFilter === '13D' && (cardFormType === '13D' || cardFormType === '13G')) {
                    show = true;
                } else if (this.activeFormTypeFilter === 'DEF 14A' && (cardFormType === 'DEF 14A' || cardFormType === 'DEF-14A' || 
                               cardFormType === 'PREM14A' || cardFormType === 'DEFA14A')) {
                    show = true;
                } else if (this.activeFormTypeFilter === '13F' && (cardFormType === '13F' || cardFormType === '13F-HR')) {
                    show = true;
                } else if (this.activeFormTypeFilter === 'D' && (cardFormType === 'D' || cardFormType === 'FORM-D')) {
                    show = true;
                } else if (cardFormType !== this.activeFormTypeFilter) {
                    show = false;
                }
            }
            
            if (show && formFilter && card.getAttribute('data-form') !== formFilter) {
                show = false;
            }
            
            if (show && exchangeFilter && card.getAttribute('data-exchange') !== exchangeFilter) {
                show = false;
            }
            
            if (show && indexFilter) {
                const cardIndices = card.getAttribute('data-indices').split(',');
                if (!cardIndices.includes(indexFilter)) {
                    show = false;
                }
            }
            
            card.style.display = show ? 'block' : 'none';
            if (show) visibleCount++;
        });

        const container = document.getElementById('filingsContainer');
        const existingNoResults = container.querySelector('.no-filings');
        if (existingNoResults) {
            existingNoResults.remove();
        }
        
        if (visibleCount === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'no-filings';
            noResults.innerHTML = `
                <h3>üîç No filings match your filters</h3>
                <p>Try adjusting your filter criteria or wait for new filings</p>
            `;
            container.appendChild(noResults);
        }
    }

    categorizeFilingForIntelligence(filing) {
        // Simplified intelligence categorization
    }

    updateTrending(filing) {
        const ticker = filing.ticker;
        if (!ticker) return;

        const now = Date.now();
        if (!this.trendingData.has(ticker)) {
            this.trendingData.set(ticker, []);
        }
        
        this.trendingData.get(ticker).push(now);
        
        this.trendingData.set(ticker, 
            this.trendingData.get(ticker).filter(time => now - time < 3600000)
        );

        this.updateTrendingDisplay();
    }

    updateTrendingDisplay() {
        const trendingContainer = document.getElementById('trendingCompanies');
        
        const sorted = Array.from(this.trendingData.entries())
            .map(([ticker, times]) => ({ ticker, count: times.length }))
            .filter(item => item.count > 0)
            .sort((a, b) => b.count - a.count)
            .slice(0, 8);

        if (sorted.length === 0) {
            trendingContainer.innerHTML = '<div class="no-filings">No activity yet...</div>';
            return;
        }

        trendingContainer.innerHTML = sorted.map(item => `
            <div class="trending-item">
                <span class="trending-ticker">${item.ticker}</span>
                <span class="trending-count">${item.count}</span>
            </div>
        `).join('');
    }

    initializePortfolioPanel() {
        document.getElementById('portfolioToggle').addEventListener('click', () => this.togglePortfolioPanel());
        document.getElementById('portfolioClose').addEventListener('click', () => this.closePortfolioPanel());
        document.getElementById('portfolioAddBtn').addEventListener('click', () => this.addFromSearch());
        document.getElementById('portfolioFilterBtn').addEventListener('click', () => this.togglePortfolioFilter());
        
        document.getElementById('portfolioSearch').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                this.addFromSearch();
            }
        });
    }

    togglePortfolioPanel() {
        const panel = document.getElementById('portfolioPanel');
        const toggle = document.getElementById('portfolioToggle');
        
        panel.classList.toggle('open');
        toggle.classList.toggle('active');
        
        if (panel.classList.contains('open')) {
            this.updatePortfolioDisplay();
        }
    }

    closePortfolioPanel() {
        const panel = document.getElementById('portfolioPanel');
        const toggle = document.getElementById('portfolioToggle');
        
        panel.classList.remove('open');
        toggle.classList.remove('active');
    }

    addFromSearch() {
        const searchInput = document.getElementById('portfolioSearch');
        const ticker = searchInput.value.trim().toUpperCase();
        
        if (ticker) {
            this.addToPortfolio(ticker);
            searchInput.value = '';
        }
    }

    updatePortfolioDisplay() {
        const grid = document.getElementById('portfolioGrid');
        
        if (this.portfolio.size === 0) {
            grid.innerHTML = `
                <div class="portfolio-empty">
                    <h3>üéØ Build Your OllyTracker<sup class="tm">‚Ñ¢</sup> Portfolio</h3>
                    <p>Add companies to track their SEC filings in real-time</p>
                    
                    <div class="portfolio-suggestions">
                        <h4>üí° Fortune 50 Picks:</h4>
                        <div class="suggestion-chips" id="suggestionChips">
                            ${this.FORTUNE50.map(ticker => `
                                <div class="suggestion-chip ${this.portfolio.has(ticker) ? 'active' : ''}" 
                                     data-ticker="${ticker}"
                                     onclick="secStream.togglePortfolioTicker('${ticker}')">
                                    ${ticker}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            return;
        }

        const portfolioCompanies = Array.from(this.portfolio).map(ticker => {
            const activity = this.portfolioActivity.get(ticker) || [];
            const recentActivity = activity.filter(time => Date.now() - time < 3600000);
            const todayActivity = activity.filter(time => Date.now() - time < 86400000);
            const lastFiling = activity.length > 0 ? activity[activity.length - 1] : null;
            
            return {
                ticker,
                companyName: this.getCompanyName(ticker),
                recentCount: recentActivity.length,
                todayCount: todayActivity.length,
                lastFiling: lastFiling,
                hasRecentActivity: recentActivity.length > 0
            };
        }).sort((a, b) => b.recentCount - a.recentCount);

        grid.innerHTML = portfolioCompanies.map(company => `
            <div class="portfolio-company ${company.hasRecentActivity ? 'has-activity' : ''}" 
                 onclick="secStream.viewCompanyProfile('${company.ticker}')">
                ${company.hasRecentActivity ? `<div class="portfolio-activity-indicator">${company.recentCount}</div>` : ''}
                
                <div class="portfolio-company-header">
                    <div class="portfolio-ticker-with-price">
                        <div class="portfolio-ticker" data-ticker="${company.ticker}">${company.ticker}</div>
                    </div>
                    <button class="portfolio-remove" onclick="event.stopPropagation(); secStream.removeFromPortfolio('${company.ticker}')">
                        ‚úï
                    </button>
                </div>
                
                <div class="portfolio-company-name">${company.companyName}</div>
                
                <div class="portfolio-activity">
                    <span class="portfolio-activity-count">${company.todayCount} filings today</span>
                    <span class="portfolio-last-filing">
                        ${company.lastFiling ? OllyEngine.Utils.formatTime(company.lastFiling) : 'No recent activity'}
                    </span>
                </div>
            </div>
        `).join('') + `
            <div class="portfolio-suggestions" style="margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                <h4 style="color: #ffd700; margin-bottom: 15px; text-align: center;">üí° Add More Companies:</h4>
                <div class="suggestion-chips" id="suggestionChips">
                    ${this.FORTUNE50.map(ticker => `
                        <div class="suggestion-chip ${this.portfolio.has(ticker) ? 'active' : ''}" 
                             data-ticker="${ticker}"
                             onclick="secStream.togglePortfolioTicker('${ticker}')">
                            ${ticker}
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    togglePortfolioTicker(ticker) {
        if (this.portfolio.has(ticker)) {
            this.removeFromPortfolio(ticker);
        } else {
            this.addToPortfolio(ticker);
        }
        
        const chip = document.querySelector(`[data-ticker="${ticker}"]`);
        if (chip) {
            if (this.portfolio.has(ticker)) {
                chip.classList.add('active');
            } else {
                chip.classList.remove('active');
            }
        }
        
        this.updatePortfolioDisplay();
    }

    getCompanyName(ticker) {
        const commonNames = {
            'WMT': 'Walmart Inc.',
            'AMZN': 'Amazon.com Inc.',
            'AAPL': 'Apple Inc.',
            'CVX': 'Chevron Corp.',
            'UNH': 'UnitedHealth Group Inc.',
            'GOOG': 'Alphabet Inc.',
            'XOM': 'Exxon Mobil Corp.',
            'BRK.A': 'Berkshire Hathaway Inc.',
            'MSFT': 'Microsoft Corp.',
            'MCK': 'McKesson Corp.',
            'ABC': 'AmerisourceBergen Corp.',
            'CVS': 'CVS Health Corp.',
            'TGT': 'Target Corp.',
            'COR': 'Cencora Inc.',
            'CAH': 'Cardinal Health Inc.',
            'HD': 'Home Depot Inc.',
            'WBA': 'Walgreens Boots Alliance Inc.',
            'JPM': 'JPMorgan Chase & Co.',
            'VZ': 'Verizon Communications Inc.',
            'GM': 'General Motors Co.',
            'BAC': 'Bank of America Corp.',
            'F': 'Ford Motor Co.',
            'CNC': 'Centene Corp.',
            'KR': 'Kroger Co.',
            'META': 'Meta Platforms Inc.',
            'COST': 'Costco Wholesale Corp.',
            'TSLA': 'Tesla Inc.',
            'ADM': 'Archer-Daniels-Midland Co.',
            'FDX': 'FedEx Corp.',
            'PFE': 'Pfizer Inc.',
            'UPS': 'United Parcel Service Inc.',
            'LMT': 'Lockheed Martin Corp.',
            'JNJ': 'Johnson & Johnson',
            'GE': 'General Electric Co.',
            'IBM': 'International Business Machines Corp.',
            'WFC': 'Wells Fargo & Co.',
            'RTX': 'Raytheon Technologies Corp.',
            'C': 'Citigroup Inc.',
            'INTC': 'Intel Corp.',
            'HPQ': 'HP Inc.',
            'DIS': 'Walt Disney Co.',
            'ORCL': 'Oracle Corp.',
            'DELL': 'Dell Technologies Inc.',
            'MS': 'Morgan Stanley',
            'AIG': 'American International Group Inc.',
            'CAT': 'Caterpillar Inc.',
            'BA': 'Boeing Co.',
            'LOW': 'Lowes Companies Inc.',
            'MCD': 'McDonalds Corp.',
            'PG': 'Procter & Gamble Co.',
            'GOOGL': 'Alphabet Inc.',
            'V': 'Visa Inc.',
            'MA': 'Mastercard Inc.',
            'ABBV': 'AbbVie Inc.',
            'KO': 'Coca-Cola Co.',
            'PEP': 'PepsiCo Inc.',
            'TMO': 'Thermo Fisher Scientific Inc.',
            'MRK': 'Merck & Co Inc.',
            'ABT': 'Abbott Laboratories',
            'NFLX': 'Netflix Inc.',
            'ADBE': 'Adobe Inc.',
            'CRM': 'Salesforce Inc.',
            'ACN': 'Accenture PLC',
            'CMCSA': 'Comcast Corp.',
            'DHR': 'Danaher Corp.',
            'NKE': 'Nike Inc.',
            'NVDA': 'NVIDIA Corporation'
        };
        
        return commonNames[ticker] || `${ticker} Corporation`;
    }

    quickAddToPortfolio(ticker) {
        this.togglePortfolioTicker(ticker);
    }

    togglePortfolioFilter() {
        this.isPortfolioFilterActive = !this.isPortfolioFilterActive;
        const btn = document.getElementById('portfolioFilterBtn');
        
        if (this.isPortfolioFilterActive) {
            btn.textContent = 'üìä Show All Filings';
            btn.classList.add('active');
            this.showNotification('üìä Now showing only your portfolio companies');
        } else {
            btn.textContent = 'üìä Show Portfolio Only';
            btn.classList.remove('active');
            this.showNotification('üìä Now showing all filings');
        }
        
        this.applyFilters();
    }

    addToPortfolio(ticker) {
        if (!ticker) return;
        
        ticker = ticker.toUpperCase();
        this.portfolio.add(ticker);
        this.showNotification(`üìä Added ${ticker} to your portfolio! You'll get enhanced alerts for all ${ticker} filings.`);
        this.updatePortfolioDisplay();
        this.updatePortfolioStats();
        this.refreshFilingCards();
    }

    removeFromPortfolio(ticker) {
        if (!ticker) return;
        
        ticker = ticker.toUpperCase();
        this.portfolio.delete(ticker);
        this.showNotification(`‚ùå Removed ${ticker} from your portfolio.`);
        this.updatePortfolioDisplay();
        this.updatePortfolioStats();
        this.refreshFilingCards();
    }

    trackPortfolioActivity(filing) {
        const ticker = filing.ticker;
        if (!this.portfolioActivity.has(ticker)) {
            this.portfolioActivity.set(ticker, []);
        }
        
        this.portfolioActivity.get(ticker).push(Date.now());
        
        const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
        this.portfolioActivity.set(ticker,
            this.portfolioActivity.get(ticker).filter(time => time > sevenDaysAgo)
        );
    }

    updatePortfolioStats() {
        const now = Date.now();
        const oneHour = 60 * 60 * 1000;
        const oneDay = 24 * 60 * 60 * 1000;
        
        let todayCount = 0;
        let lastHourCount = 0;
        
        for (const [ticker, activity] of this.portfolioActivity) {
            if (this.portfolio.has(ticker)) {
                todayCount += activity.filter(time => now - time < oneDay).length;
                lastHourCount += activity.filter(time => now - time < oneHour).length;
            }
        }
        
        document.getElementById('portfolioCount').textContent = this.portfolio.size;
        document.getElementById('portfolioActivityToday').textContent = todayCount;
        document.getElementById('portfolioLastHour').textContent = lastHourCount;
    }

    refreshFilingCards() {
        const cards = document.querySelectorAll('.filing-card');
        cards.forEach(card => {
            const ticker = card.getAttribute('data-ticker');
            const isPortfolioCompany = this.portfolio.has(ticker);
            
            if (isPortfolioCompany) {
                card.classList.add('portfolio-company-filing');
            } else {
                card.classList.remove('portfolio-company-filing');
            }
            
            const badgesContainer = card.querySelector('.company-badges');
            const existingPortfolioBadge = badgesContainer?.querySelector('.portfolio-badge');
            
            if (existingPortfolioBadge) {
                existingPortfolioBadge.remove();
            }
            
            if (isPortfolioCompany && badgesContainer) {
                const portfolioBadge = document.createElement('span');
                portfolioBadge.className = 'index-badge portfolio-badge';
                portfolioBadge.style.background = 'rgba(255,215,0,0.3)';
                portfolioBadge.style.color = '#ffd700';
                portfolioBadge.innerHTML = 'üìä Portfolio';
                badgesContainer.insertBefore(portfolioBadge, badgesContainer.firstChild);
            }
            
            const watchBtn = card.querySelector('.portfolio-btn');
            if (watchBtn) {
                watchBtn.textContent = isPortfolioCompany ? 'üìä Remove' : 'üìä Add to Portfolio';
            }
        });
    }

    filterByFormType(formType) {
        this.activeFormTypeFilter = formType;
        
        document.querySelectorAll('.form-type-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        const activeButton = Array.from(document.querySelectorAll('.form-type-btn')).find(btn => {
            return btn.onclick && btn.onclick.toString().includes(`'${formType}'`);
        });
        if (activeButton) {
            activeButton.classList.add('active');
        }
        
        const cards = document.querySelectorAll('.filing-card');
        let visibleCount = 0;
        
        cards.forEach(card => {
            let show = true;
            
            if (this.isPortfolioFilterActive) {
                const ticker = card.getAttribute('data-ticker');
                if (!this.portfolio.has(ticker)) {
                    show = false;
                }
            }
            
            if (show) {
                const cardFormType = card.getAttribute('data-form');
                
                if (formType === '3' && (cardFormType === '3' || cardFormType.includes('3') && cardFormType.length <= 6)) {
                    show = true;
                } else if (formType === '4' && (cardFormType === '4' || cardFormType.includes('4') && cardFormType.length <= 6)) {
                    show = true;
                } else if (formType === '5' && (cardFormType === '5' || cardFormType.includes('5') && cardFormType.length <= 6)) {
                    show = true;
                } else if (formType === '13D' && (cardFormType === '13D' || cardFormType === '13G')) {
                    show = true;
                } else if (formType === 'DEF 14A' && (cardFormType === 'DEF 14A' || cardFormType === 'DEF-14A' || 
                               cardFormType === 'PREM14A' || cardFormType === 'DEFA14A')) {
                    show = true;
                } else if (formType === '13F' && (cardFormType === '13F' || cardFormType === '13F-HR')) {
                    show = true;
                } else if (formType === 'D' && (cardFormType === 'D' || cardFormType === 'FORM-D')) {
                    show = true;
                } else if (cardFormType !== formType) {
                    show = false;
                }
            }
            
            card.style.display = show ? 'block' : 'none';
            if (show) visibleCount++;
        });

        const container = document.getElementById('filingsContainer');
        const existingNoResults = container.querySelector('.no-filings');
        if (existingNoResults) {
            existingNoResults.remove();
        }
        
        if (visibleCount === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'no-filings';
            noResults.innerHTML = `
                <h3>üìã No ${this.getFormTypeDescription(formType)} filings found</h3>
                <p>Wait for new ${formType} filings to arrive or try a different form type</p>
            `;
            container.appendChild(noResults);
        }

        this.showNotification(`üìã Filtered to show ${this.getFormTypeDescription(formType)} only. ${visibleCount} filings visible.`);
        
        document.getElementById('filingsContainer').scrollIntoView({ behavior: 'smooth' });
    }

    clearFormTypeFilter() {
        this.activeFormTypeFilter = null;
        
        document.querySelectorAll('.form-type-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        const allButton = Array.from(document.querySelectorAll('.form-type-btn')).find(btn => {
            return btn.classList.contains('all');
        });
        if (allButton) {
            allButton.classList.add('active');
        }
        
        this.applyFilters();
        
        this.showNotification('üìã Now showing all filing types');
    }

    getFormTypeDescription(formType) {
        const descriptions = {
            '10-K': '10-K Annual Reports',
            '10-Q': '10-Q Quarterly Reports',
            '8-K': '8-K Current Reports',
            '3': 'Form 3 Initial Ownership',
            '4': 'Form 4 Insider Trading',
            '5': 'Form 5 Annual Statement',
            '13F': '13F Institutional Holdings',
            'DEF 14A': 'DEF 14A Proxy Statements',
            'S-1': 'S-1 IPO Registration',
            'D': 'Form D Private Offerings',
            '13D': '13D/G Beneficial Ownership',
            '144': 'Form 144 Notice of Sale'
        };
        return descriptions[formType] || formType + ' filings';
    }

    showPortfolioNotification(filing) {
        this.showNotification(`üìä ${filing.ticker} (Portfolio): ${filing.formType} filing`);
    }

    playNotificationSound() {
        if (this.soundEnabled && 'AudioContext' in window) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }
    }

    playPortfolioNotificationSound() {
        if (this.soundEnabled && 'AudioContext' in window) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.1);
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.2);
            
            gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }
    }

    startPeriodicUpdates() {
        setInterval(() => {
            this.updatePortfolioStats();
            if (document.getElementById('portfolioPanel').classList.contains('open')) {
                this.updatePortfolioDisplay();
            }
        }, 5000);
    }
}

// Initialize and connect
const secStream = new SECFilingStream();

// Auto-connect when page loads
window.addEventListener('load', () => {
    secStream.connect();
});

// Make all trending tickers clickable
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('trending-ticker')) {
        const ticker = e.target.innerText;
        window.open(`https://www.sec.gov/cgi-bin/browse-edgar?ticker=${ticker}`, '_blank');
    }
});
    </script>
</body>
</html>